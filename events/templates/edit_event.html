{% extends base_template %}
{% load static %}
{% block title %}Event Update{% endblock title %}
{% block content %}
<section id="event-details-section" class="mt-10">
    <div class="bg-white p-8 rounded-xl shadow-lg max-w-5xl mx-auto">
        <h2 class="text-2xl font-extrabold mb-8 text-center text-gray-800">Event Update</h2>

        <form method="POST" enctype="multipart/form-data" action="{% url 'edit_event' event.id %}" class="space-y-8">
            {% csrf_token %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div class="bg-gray-50 p-6 rounded-lg shadow">
                        <label class="block mb-2 font-semibold text-gray-700">Event Name</label>
                        <input type="text" name="event_name" value="{{ event.name }}"
                            class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-green-400 focus:outline-none">

                        <label class="block mt-4 mb-2 font-semibold text-gray-700">Date</label>
                        <input type="date" name="event_datetime" value="{{ event.date|date:"Y-m-d" }}"
                            class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-green-400 focus:outline-none">

                        <label class="block mt-4 mb-2 font-semibold text-gray-700">Location</label>
                        <input type="text" name="event_location" value="{{ event.location }}"
                            class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-green-400 focus:outline-none">

                        <label class="block mt-4 mb-2 font-semibold text-gray-700">Category</label>
                        <input type="text" name="event_category" value="{{ event.category.name }}"
                            class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-green-400 focus:outline-none">

                        <label class="block mt-4 mb-2 font-semibold text-gray-700">Participants</label>
                        <span>{{ event.participants.count }}</span>

                        <label class="block mt-4 mb-2 font-semibold text-gray-700">Status</label>
                        <input type="text" value="Upcoming"
                            class="w-full border border-gray-300 rounded-md p-2 bg-gray-100" readonly>
                    </div>

                    <div class="bg-gray-50 p-6 rounded-lg shadow">
                        <h3 class="font-semibold text-lg mb-4 text-gray-700">Organizer Details</h3>
                        <p class="text-gray-600 mb-2"><span class="font-semibold">Name:</span>
                            {{ event.organizer.get_full_name }}</p>
                        <p class="text-gray-600"><span class="font-semibold">Email:</span> {{ event.organizer.email }}
                        </p>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="bg-gray-50 p-6 rounded-lg shadow">
                        <label class="block mb-2 font-semibold text-gray-700">Description</label>
                        <input type="text" name="event_description" value="{{ event.description }}"
                            class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-green-400 focus:outline-none">
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow flex flex-col items-center">
                        <img src="{{ event.image.url }}" alt="Event Image"
                            class="w-full h-48 sm:h-64 object-cover rounded-md mb-4 border">
                        <input type="file" name="image" id="event-image" alt="Event Image"
                            class="w-full h-auto rounded-md border border-gray-300 p-2">
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-lg shadow">
                <h3 class="font-semibold text-lg mb-4 text-center text-gray-700">Participants</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full border-collapse border border-gray-300 text-sm sm:text-base">
                        <thead>
                            <tr class="bg-green-100">
                                <th class="px-4 py-2 text-left">Name</th>
                                <th class="px-4 py-2 text-left">Email</th>
                                <th class="px-4 py-2 text-left">Registration Date</th>
                                <th class="px-4 py-2 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for participant in event.participants.all %}
                            <tr class="border-t hover:bg-green-50 participant-row" data-value="{{ participant.id }}">
                                <td class="px-4 py-2">{{ participant.get_full_name }}</td>
                                <td class="px-4 py-2">{{ participant.email }}</td>
                                <td class="px-4 py-2">{{ participant.registration_date|date:"F j, Y" }}</td>
                                <td class="px-4 py-2 flex flex-col sm:flex-row gap-2">
                                    <button class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition">View</button>
                                    <button type="button" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition remove-participant-btn" data-id="{{ participant.id }}">Remove</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-lg shadow mt-8">
                <h3 class="font-semibold text-lg mb-4 text-center text-gray-700">Add Participants</h3>
                <label for="event-participants"
                    class="block text-sm font-medium text-gray-700 mb-2">Participants</label>
                <div class="flex">
                    <select name="participants-select" id="event-participants" multiple class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-green-400 focus:outline-none">
                            {% for user in users %}
                                <option value="{{ user.id }}">{{ user.get_full_name }}</option>
                            {% endfor %}
                    </select>
                    <button type="button" id="add-participant"
                        class="bg-green-500 text-white rounded-md p-2 ml-2 hover:bg-green-600 transition">Add</button>
                </div>
                <ul id="selected-participants" class="mt-2 list-disc list-inside text-gray-700"></ul>
            </div>

            <div id="participant-inputs-container"></div>

            <div class="flex flex-col justify-center items-center sm:flex-row gap-4 mt-8">
                <button type="submit"
                    class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition w-full sm:w-auto font-semibold text-lg">Update
                    Event</button>
            </div>
        </form>
    </div>
</section>

<script src="{% static 'js/script.js' %}"></script>
{% block footer %}
{% include "footer.html" %}
{% endblock footer %}
{% endblock content %}